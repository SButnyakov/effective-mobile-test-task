# effective-mobile-test-task
 
Тестовое задание в Effective Mobile на позицию Junior Go-разработчик

## Запуск

### Докер
```
> docker-compose build
> docker-compose up
```

### Локально

Зависимости
```
> go mod download
> go run 
```
Миграция
```
> go run cmd/migrations/postgres/main.go top
```
Запуск
```
> go run cmd/api/main.go
```

## Миграции

`cmd/migrations/main.go` принимает аргумент трёх видов:
- `n` - число, отвечающее за количество миграций (`n` > 0 - вверх, `n` < 0 - вниз, `n` = 0 - ошибка)
- `top` - к самой последней версии
- `drop` - сбросить все миграции

## Конфигурирование

### Для докера

файл `.env` в корневом каталоге

### Для локального запуска

файл `config/local.env`

## Ручки

### Create `POST`

`api/v1/persons/create` - добавление новой сущности

#### Запрос:

Body:

```
{
    "name": string, # len>0
    "surname": string # len>0
    "patronymic": string # необязательно
}
```

#### Ответы:
| код   | тело | пояснение                                                |
|-------|------|----------------------------------------------------------|
| `201` | -    | сущность **добавлена**                                   |
| `400` | -    | сущность **не добавлена**; неверный запрос               |
| `502` | -    | сущность **не добавлена**; проблема у стороннего сервиса |
| `507` | -    | сущность **не добавлена**; проблема с базой данных       |


### Delete `POST`

`api/v1/persons/delete?id={id}` - удаление сущности

#### Запрос:

Query:

| имя  | тип   | значение                         | обязателен |
|------|-------|----------------------------------|------------|
| `id` | `int` | идентификатор удаляемой сущности | да         |


#### Ответы:
| код   | тело | пояснение                                            |
|-------|------|------------------------------------------------------|
| `200` | -    | сущность **удалена**                                 |
| `400` | -    | сущность **не удалена**; неверный запрос             |
| `404` | -    | сущность **не удалена**; сущность не найдена         |
| `500` | -    | сущность **не удалена**; проблема на стороне сервера |

### Update `PUT`

`api/v1/persons/update` - удаление сущности

#### Запрос:

Body:

```
{
    "id": int,
    "name": string, # len>0, необязательно
    "surname": string, # len>0, необязательно
    "patronymic": string, # необязательно
    "age": int, # >= 0, необязательно
    "gender": string, # [male, female], необязательно
    "nationality": string, # len>0, необязательно
}
```

#### Ответы:
| код   | тело | пояснение                                         |
|-------|------|---------------------------------------------------|
| `200` | -    | сущность **изменена**                             |
| `400` | -    | сущность **не изменена**; неверный запрос         |
| `404` | -    | сущность **не изменена**; сущность не найдена     |
| `507` | -    | сущность **не изменена**; проблема с базой данных |

### Get `GET`

`api/v1/persons?id={id}&name={name}&surname={surname}&patronymic={patronymic}&age={age}&gender={gender}&nationality={nationality}&page={page}` - удаление сущности

#### Запрос:

Query:

| имя           | тип      | значение                                                                                                          |
|---------------|----------|-------------------------------------------------------------------------------------------------------------------|
| `id`          | `int`    | идентификатор; если **представлен**, то телом ответа будет `SingleObjectResponse`, иначе `MultipleObjectResponse` |
| `name`        | `string` | имя                                                                                                               |
| `surname`     | `string` | фамилия                                                                                                           |
| `patronymic`  | `string` | отчество                                                                                                          |
| `age`         | `uint8`  | возраст                                                                                                           |
| `gender`      | `string` | пол                                                                                                               |
| `nationality` | `string` | национальность                                                                                                    |

#### Типы ответов:
- `SingleResponseObject`
```
{
    "id": int,
    "name": string,
    "surname": string,
    "patronymic": string,
    "age": int,
    "gender": string,
    "nationality": string,
}
```
- ```MultipleResponseObject```
```
{
    "persons": [
        SingleResponseObject,
        SingleResponseObject,
        ...
    ]
}
```

#### Ответы:
- если **представлен** `id`

| код   | тело                   | пояснение                                            |
|-------|------------------------|------------------------------------------------------|
| `200` | `SingleObjectResponse` | сущность **найдена**                                 |
| `400` | -                      | сущность **не найдена**; неверный запрос             |
| `404` | -                      | сущность **не найдена**                              |
| `500` | -                      | сущность **не найдена**; проблема на стороне сервера |

- если **не представлен** `id`

| код   | тело                     | пояснение                                            |
|-------|--------------------------|------------------------------------------------------|
| `200` | `MultipleObjectResponse` | запрос выполнен; сущности **могут быть не найдены**  |
| `400` | -                        | сущности **не найдены**; неверный запрос             |
| `500` | -                        | сущности **не найдены**; проблема на стороне сервера |

## Swagger

По адресу `swagger/index.html` представлен GUI со всеми выше описанными ручками
